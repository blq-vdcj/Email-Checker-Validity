import openpyxl
import re
import os

# Charger le fichier Excel
fichier = "email.xlsx"  # Nom du fichier
wb = openpyxl.load_workbook(fichier)
sheet = wb.active

# Fonction pour vérifier la validité des adresses e-mail
def est_email_valide(email):
    motif = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
    
    # Vérifier si l'e-mail correspond au motif, ne contient pas ".." et ne se termine pas par .co
    if re.match(motif, email) and ".." not in email and not email.endswith(".co"):
        return True
    return False

# Vérifier toutes les lignes de la colonne A
for row in range(1, sheet.max_row + 1):
    cellule = f"A{row}"
    email = sheet[cellule].value
    if email:
        validité = "Valide" if est_email_valide(email) else "Invalide"
        sheet[f"B{row}"] = validité  # Écrire le résultat dans la colonne B

# Déterminer le nom de fichier de sortie
base_filename = "resultat_verification"
extension = ".xlsx"
filename = base_filename + extension
counter = 1

# Incrémenter le nom de fichier si le fichier existe déjà
while os.path.exists(filename):
    filename = f"{base_filename}_{counter}{extension}"
    counter += 1

# Sauvegarder les résultats dans un nouveau fichier
wb.save(filename)
